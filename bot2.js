const fs = require("fs");
const os = require("os");
const path = require("path");
const events = require("./events");
const chalk = require('chalk');
const config = require('./config');
const axios = require('axios');
const Heroku = require('heroku-client');
const {WAConnection, MessageOptions, MessageType, Mimetype, Presence} = require('@adiwajshing/baileys');
const {Message, StringSession, Image, Video} = require('./whatsasena/');
const { DataTypes } = require('sequelize');
const { GreetingsDB, getMessage } = require("./plugins/sql/greetings");
const got = require('got');
const simpleGit = require('simple-git');
const git = simpleGit();
const crypto = require('crypto');
const nw = '```Blacklist Defected!```'
const heroku = new Heroku({
    token: config.HEROKU.API_KEY
});
let baseURI = '/apps/' + config.HEROKU.APP_NAME;
const Language = require('./language');
const Lang = Language.getString('updater');

       if (config.WORKTYPE == 'public') {
            if (config.LANG == 'EN') {
                if (config.FULLEVA == 'true') {
                    await conn.sendMessage(conn.user.jid, EVA_ACTƒ∞ON, MessageType.text)
                } else {
                    await conn.sendMessage(conn.user.jid, '```BOT WORKING AS PUBLIC!```\n```TO CHANGE PRIVATE``` *< .setvar WORK_TYPE:private >*\n\n', MessageType.text);
                }               
                await git.fetch();
                var commits = await git.log([config.BRANCH + '..origin/' + config.BRANCH]);
                if (commits.total === 0) {
                    await conn.sendMessage(
                        conn.user.jid,
                        Lang.UPDATE, MessageType.text
                    );    
                } else {
                    var degisiklikler = Lang.NEW_UPDATE;
                    commits['all'].map(
                        (commit) => {
                            degisiklikler += 'üî∏ [' + commit.date.substring(0, 10) + ']: ' + commit.message + ' ‚óÅ' + commit.author_name + '‚ñ∑\n';
                        }
                    );
        
                    await conn.sendMessage(
                        conn.user.jid,
                        '```NEW UPDATE AVAILABLE FOR YOUR BOT!```\n```TO UPDATE``` *< .update now >*\n\n' + degisiklikler + '```', MessageType.text
                    ); 
                }
            }
        }
        else if (config.WORKTYPE == 'private') { 
            if (config.LANG == 'EN') {  
                if (config.FULLEVA == 'true') {
                    await conn.sendMessage(conn.user.jid, EVA_ACTƒ∞ON, MessageType.text)
                } else {
                    await conn.sendMessage(conn.user.jid, '```BOT WORKING AS PRIVATE!```\n```TO CHANGE PUBLIC``` *< .setvar WORK_TYPE:public >*\n\n', MessageType.text);
                }
                await git.fetch();
                var commits = await git.log([config.BRANCH + '..origin/' + config.BRANCH]);
                if (commits.total === 0) {
                    await conn.sendMessage(
                        conn.user.jid,
                        Lang.UPDATE, MessageType.text
                    );    
                } else {
                    var degisiklikler = Lang.NEW_UPDATE;
                    commits['all'].map(
                        (commit) => {
                            degisiklikler += 'üî∏ [' + commit.date.substring(0, 10) + ']: ' + commit.message + ' ‚óÅ' + commit.author_name + '‚ñ∑\n';
                        }
                    );
                    await conn.sendMessage(
                        conn.user.jid,
                        '```TYPE``` *.update now* ````TO UPDATE YOUR BOT!```\n\n' + degisiklikler + '```', MessageType.text
                    ); 
                }
            }
        }
